<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modules &mdash; sparcstools 0.0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="../_static/fonts.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=d45e8c67"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="1. Tutorials" href="tutorials.html" />
    <link rel="prev" title="Welcome to SPARCStools documentation!" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            sparcstools
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Modules:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#parse">parse</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sparcstools.parse.parse_phenix"><code class="docutils literal notranslate"><span class="pre">parse_phenix()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#sparcstools.parse.parse_phenix_40X_slide"><code class="docutils literal notranslate"><span class="pre">parse_phenix_40X_slide()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#sparcstools.parse.sort_timepoints"><code class="docutils literal notranslate"><span class="pre">sort_timepoints()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#sparcstools.parse.sort_wells"><code class="docutils literal notranslate"><span class="pre">sort_wells()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#stitch">stitch</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sparcstools.stitch.generate_stitched"><code class="docutils literal notranslate"><span class="pre">generate_stitched()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#sparcstools.stitch.generate_thumbnail"><code class="docutils literal notranslate"><span class="pre">generate_thumbnail()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#sparcstools.stitch.prepare_stitch_slurm_job"><code class="docutils literal notranslate"><span class="pre">prepare_stitch_slurm_job()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#image-processing">image processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sparcstools.image_processing.downsample_folder"><code class="docutils literal notranslate"><span class="pre">downsample_folder()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#sparcstools.image_processing.downsample_folder_copy_images"><code class="docutils literal notranslate"><span class="pre">downsample_folder_copy_images()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#sparcstools.image_processing.downsample_img"><code class="docutils literal notranslate"><span class="pre">downsample_img()</span></code></a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">1. Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#parsing-and-stitching-data-from-opera-phenix">1.1. Parsing and Stitching Data from Opera Phenix</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorials.html#generated-output">1.1.1. Generated output</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorials.html#example-results">1.1.2. Example Results</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Notebooks:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notebooks/example_stitching_notebook.html">1. Example Stitching Notebook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="notebooks/example_stitching_notebook.html#Visualize-Stitching-Output">1.1. Visualize Stitching Output</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">sparcstools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Modules</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/pages/modules.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-sparcstools.parse">
<span id="modules"></span><h1>Modules<a class="headerlink" href="#module-sparcstools.parse" title="Link to this heading"></a></h1>
<section id="parse">
<h2>parse<a class="headerlink" href="#parse" title="Link to this heading"></a></h2>
<p>Contains functions to parse imaging data into a usable formats for downstream pipelines.</p>
</section>
<dl class="py function">
<dt class="sig sig-object py" id="sparcstools.parse.parse_phenix">
<span class="sig-prename descclassname"><span class="pre">sparcstools.parse.</span></span><span class="sig-name descname"><span class="pre">parse_phenix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">phenix_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flatfield_exported</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">WGAbackground</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">export_meta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">export_as_symlink</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sparcstools.parse.parse_phenix" title="Link to this definition"></a></dt>
<dd><p>Function to automatically rename TIFS exported from Harmony into a format where row and well ID as well as Tile position are indicated in the file name.
Example of an exported file name: “Timepoint{#}_Row{#}_Well{#}_{channel}_zstack{#}_r{#}_c{#}.tif”</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>phenix_dir</strong> – Path indicating the exported harmony files to parse.</p></li>
<li><p><strong>flatfield_exported</strong> (<em>bool</em>) – boolean indicating if the data was exported from harmony with or without flatfield correction.</p></li>
<li><p><strong>WGAbackground</strong> – export second copy of WGA stains for background correction to improve segmentation. If set to False not performed. Else enter value of the channel
that should be copied and contains the WGA stain.</p></li>
<li><p><strong>export_meta</strong> – boolean value indicating if a metadata file containing, tile positions, exact time of measurement etc. should be written out.</p></li>
<li><p><strong>export_as_symlink</strong> – boolean value indicating if the parsed files should be copied or symlinked. If set to true can lead to issues when accessing remote filesystems
from differentoperating systems</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sparcstools.parse.parse_phenix_40X_slide">
<span class="sig-prename descclassname"><span class="pre">sparcstools.parse.</span></span><span class="sig-name descname"><span class="pre">parse_phenix_40X_slide</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">phenix_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flatfield_exported</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">downsampled</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">WGAbackground</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">export_meta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">export_as_symlink</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sparcstools.parse.parse_phenix_40X_slide" title="Link to this definition"></a></dt>
<dd><p>Function to automatically rename TIFS exported from Harmony into a format where row and well ID as well as Tile position are indicated in the file name.
Example of an exported file name: “Timepoint{#}_Row{#}_Well{#}_{channel}_zstack{#}_r{#}_c{#}.tif”</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>phenix_dir</strong> – Path indicating the exported harmony files to parse.</p></li>
<li><p><strong>flatfield_exported</strong> (<em>bool</em>) – boolean indicating if the data was exported from harmony with or without flatfield correction.</p></li>
<li><p><strong>WGAbackground</strong> – export second copy of WGA stains for background correction to improve segmentation. If set to False not performed. Else enter value of the channel
that should be copied and contains the WGA stain.</p></li>
<li><p><strong>export_meta</strong> – boolean value indicating if a metadata file containing, tile positions, exact time of measurement etc. should be written out.</p></li>
<li><p><strong>export_as_symlink</strong> – boolean value indicating if the parsed files should be copied or symlinked. If set to true can lead to issues when accessing remote filesystems
from differentoperating systems</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sparcstools.parse.sort_timepoints">
<span class="sig-prename descclassname"><span class="pre">sparcstools.parse.</span></span><span class="sig-name descname"><span class="pre">sort_timepoints</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parsed_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_symlink</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sparcstools.parse.sort_timepoints" title="Link to this definition"></a></dt>
<dd><p>Additionally sort generated timecourse images according to well and tile position. Function
generates a new folder called timecourse_sorted which contains a unqiue folder for each unique tile
position containing all imaging data (i.e. zstacks, timepoints, channels) of that tile.
This function is meant for quick sorting of generated images for simple import of e.g. timecourse
experiments into FIJI.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>parsed_dir</strong> – filepath to parsed images folder generated with the function parse_phenix.</p></li>
<li><p><strong>use_symlonks</strong> (<em>bool</em>) – boolean value indicating if the images should be copied as symlinks or as regular files. Symlinks can potentially cause issues if using the data on
different OS but is signficiantly faster and does not produce as much data overhead.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sparcstools.parse.sort_wells">
<span class="sig-prename descclassname"><span class="pre">sparcstools.parse.</span></span><span class="sig-name descname"><span class="pre">sort_wells</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parsed_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_symlink</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">assign_random_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sparcstools.parse.sort_wells" title="Link to this definition"></a></dt>
<dd><p>Sort acquired phenix images into unique folders for each well.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>parsed_dir</strong> – filepath to parsed images folder generated with the function parse_phenix.</p></li>
<li><p><strong>use_symlink</strong> – boolean value indicating if the images should be copied as symlinks to their new destination</p></li>
<li><p><strong>assign_random_id</strong> – boolean value indicating if the images in the sorted wells folder should be prepended with a random id.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="stitch">
<span id="module-sparcstools.stitch"></span><h2>stitch<a class="headerlink" href="#stitch" title="Link to this heading"></a></h2>
<p>Collection of functions to perform stitching of parsed image Tiffs.</p>
</section>
<dl class="py function">
<dt class="sig sig-object py" id="sparcstools.stitch.generate_stitched">
<span class="sig-prename descclassname"><span class="pre">sparcstools.stitch.</span></span><span class="sig-name descname"><span class="pre">generate_stitched</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slidename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pattern</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outdir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overlap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_shift</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">30</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stitching_channel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Alexa488'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">crop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'bottom':</span> <span class="pre">0,</span> <span class="pre">'left':</span> <span class="pre">0,</span> <span class="pre">'right':</span> <span class="pre">0,</span> <span class="pre">'top':</span> <span class="pre">0}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_QC</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filetype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['.tif']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">WGAchannel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_intensity_rescale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rescale_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(1,</span> <span class="pre">99)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">no_rescale_channel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">export_XML</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_tile_positions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel_order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sparcstools.stitch.generate_stitched" title="Link to this definition"></a></dt>
<dd><p>Function to generate a stitched image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_dir</strong> (<em>str</em>) – Path to the folder containing exported TIF files named with the following nameing convention: “Row{#}_Well{#}_{channel}_zstack{#}_r{#}_c{#}.tif”.
These images can be generated for example by running the sparcstools.parse.parse_phenix() function.</p></li>
<li><p><strong>slidename</strong> (<em>str</em>) – string indicating the slidename that is added to the stitched images generated</p></li>
<li><p><strong>pattern</strong> (<em>str</em>) – Regex string to identify the naming pattern of the TIFs that should be stitched together.
For example: “Row1_Well2_{channel}_zstack3_r{row:03}_c{col:03}.tif”.
All values in {} indicate those which are matched by regex to find all matching tifs.</p></li>
<li><p><strong>outdir</strong> (<em>str</em>) – path indicating where the stitched images should be written out</p></li>
<li><p><strong>overlap</strong> (<em>float between 0 and 1</em>) – value between 0 and 1 indicating the degree of overlap that was used while recording data at the microscope.</p></li>
<li><p><strong>max_shift</strong> (<em>int</em>) – value indicating the maximum threshold for tile shifts. Default value in ashlar is 15. In general this parameter does not need to be adjusted but it is provided
to give more control.</p></li>
<li><p><strong>stitching_channel</strong> (<em>str</em>) – string indicating the channel name on which the stitching should be calculated. the positions for each tile calculated in this channel will be
passed to the other channels.</p></li>
<li><p><strong>crop</strong> – dictionary of the form {‘top’:0, ‘bottom’:0, ‘left’:0, ‘right’:0} indicating how many pixels (based on a generated thumbnail,
see sparcstools.stitch.generate_thumbnail) should be cropped from the final image in each indicated dimension. Leave this set to default
if no cropping should be performed.</p></li>
<li><p><strong>plot_QC</strong> (<em>bool</em>) – boolean value indicating if QC plots should be generated</p></li>
<li><p><strong>filetype</strong> (<em>[</em><em>str</em><em>]</em>) – list containing any of [“.tif”, “.ome.zarr”, “.ome.tif”] defining to which type of file the stiched results should be written. If more than one
element is present in the list all export types will be generated in the same output directory.</p></li>
<li><p><strong>WGAchannel</strong> (<em>str</em>) – string indicating the name of the WGA channel in case an illumination correction should be performed on this channel</p></li>
<li><p><strong>do_intensity_rescale</strong> (<em>bool</em><em> | </em><em>&quot;partial&quot;</em><em> | </em><em>&quot;full_image&quot;</em>) – boolean value indicating if the rescale_p1_P99 function should be applied to individual tiles before stitching or not. Alternatively this parameter can alos be set to partial which applies the rescale function to
all channels except those specied in no_rescale_channel. Finally this parameter can also be set to “full image” which does not apply a rescaling tile wise but instead to the completely assembled image after stitching
on a per channel basis. This ensures that all channels are scaled to the same range.</p></li>
<li><p><strong>rescale_range</strong> (<em>(</em><em>lower</em><em>, </em><em>upper</em><em>) </em><em>| </em><em>dict</em><em>(</em><em>{channel:</em><em> (</em><em>lower</em><em>, </em><em>upper</em><em>)</em><em>}</em><em>)</em>) – tuple indicating the lower and upper percentile to use for percentile rescaling. Default is (1, 99) which means that the 1st and 99th percentile are used for rescaling. Alternatively a dictionary can be passed with custom values per channel.</p></li>
<li><p><strong>no_rescale_channel</strong> (<em>None</em><em> | </em><em>[</em><em>str</em><em>]</em>) – either None or a list of channel strings on which no rescaling before stitching should be performed.</p></li>
<li><p><strong>export_XML</strong> – boolean value. If true then an xml is exported when writing to .tif which allows for the import into BIAS.</p></li>
<li><p><strong>return_tile_positions</strong> (<em>bool</em><em> | </em><em>default = True</em>) – boolean value. If true and return_type != “return_array” the tile positions are written out to csv.</p></li>
<li><p><strong>channel_order</strong> (<em>None</em><em> | </em><em>[</em><em>str</em><em>]</em>) – if None do nothing, if list of channel names is supplied the channels are remapped into the specified order</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sparcstools.stitch.generate_thumbnail">
<span class="sig-prename descclassname"><span class="pre">sparcstools.stitch.</span></span><span class="sig-name descname"><span class="pre">generate_thumbnail</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pattern</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outdir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overlap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stitching_channel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'DAPI'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">export_examples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_intensity_rescale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rescale_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(1,</span> <span class="pre">99)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sparcstools.stitch.generate_thumbnail" title="Link to this definition"></a></dt>
<dd><p>Function to generate a scaled down thumbnail of stitched image. Can be used for example to
get a low resolution overview of the scanned region to select areas for exporting high resolution
stitched images.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_dir</strong> (<em>str</em>) – Path to the folder containing exported TIF files named with the following nameing convention: “Row{#}_Well{#}_{channel}_zstack{#}_r{#}_c{#}.tif”.
These images can be generated for example by running the sparcstools.parse.parse_phenix() function.</p></li>
<li><p><strong>pattern</strong> (<em>str</em>) – Regex string to identify the naming pattern of the TIFs that should be stitched together.
For example: “Row1_Well2_{channel}_zstack3_r{row:03}_c{col:03}.tif”.
All values in {} indicate those which are matched by regex to find all matching tifs.</p></li>
<li><p><strong>outdir</strong> – path indicating where the stitched images should be written out</p></li>
<li><p><strong>overlap</strong> – value between 0 and 1 indicating the degree of overlap that was used while recording data at the microscope.</p></li>
<li><p><strong>name</strong> – string indicating the slidename that is added to the stitched images generated</p></li>
<li><p><strong>export_examples</strong> – boolean value indicating if individual example tiles should be exported in addition to performing thumbnail generation.</p></li>
<li><p><strong>do_intensity_rescale</strong> – boolean value indicating if the rescale_p1_P99 function should be applied before stitching or not.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sparcstools.stitch.prepare_stitch_slurm_job">
<span class="sig-prename descclassname"><span class="pre">sparcstools.stitch.</span></span><span class="sig-name descname"><span class="pre">prepare_stitch_slurm_job</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stitching_channel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mCherry'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zstack_value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rescale_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0.1,</span> <span class="pre">99.9)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overlap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jobs_per_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">24</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sparcstools.stitch.prepare_stitch_slurm_job" title="Link to this definition"></a></dt>
<dd><p>Function to generate all required output to execute an arrayed batch job to stitch all
wells contained within a Harmony directory.</p>
<p>Once run navigate to the generated folder (slurm_jobs/stitch_all/logs) in the main harmony project directory
and run “sbatch ../run.sh”.</p>
<p>The sbatch array automatically limits the maximum number of running jobs at a time to 20.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>str</em>) – Folder containing the exported Harmony output generated with SPARCStools.</p></li>
<li><p><strong>stitching_channel</strong> (<em>str</em><em>, </em><em>optional</em>) – String indicating which channel should be stitched on. Defaults to “mCherry”.</p></li>
<li><p><strong>zstack_value</strong> (<em>int</em><em>, </em><em>optional</em>) – Integer indicating which zstack level stitching should be performed on. Defaults to 1.</p></li>
<li><p><strong>rescale_range</strong> (<em>tuple</em><em>, </em><em>optional</em>) – Percentage range for rescaling images before stitching them. Defaults to (0.1, 99.9).</p></li>
<li><p><strong>overlap</strong> (<em>float</em><em>, </em><em>optional</em>) – Tile overlap as fraction. Defaults to 0.1.</p></li>
<li><p><strong>jobs_per_file</strong> (<em>int</em><em>, </em><em>optional</em>) – How many stitching executions should be executed per slurm job. Too few jobs will generate too much overhead and become inefficient. Defaults to 24.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="image-processing">
<span id="module-sparcstools.image_processing"></span><h2>image processing<a class="headerlink" href="#image-processing" title="Link to this heading"></a></h2>
<p>Contains functions to perform standard image processing steps, e.g. downsampling.</p>
</section>
<dl class="py function">
<dt class="sig sig-object py" id="sparcstools.image_processing.downsample_folder">
<span class="sig-prename descclassname"><span class="pre">sparcstools.image_processing.</span></span><span class="sig-name descname"><span class="pre">downsample_folder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">folder_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_threads</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_ending</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">('.tif',</span> <span class="pre">'.tiff')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sparcstools.image_processing.downsample_folder" title="Link to this definition"></a></dt>
<dd><p>Multi-Threaded Function to downsample image equivalent to 2x2 binning. Overwrites original images! Do not run multiple times.
Output is saved as uint16.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>folder_path</strong> (<em>str</em>) – string indicating the folder containing all the image files that should be downsampled</p></li>
<li><p><strong>num_threads</strong> (<em>int</em>) – number of threads for multithreading</p></li>
<li><p><strong>file_ending</strong> (<em>str</em><em> | </em><em>(</em><em>str</em><em>, </em><em>str</em><em>)</em>) – string or tuple of strings indicating which file ending the script should filter for in the indicated folder</p></li>
<li><p><strong>N</strong> (<em>int</em>) – number of pixels that should be binned together</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sparcstools.image_processing.downsample_folder_copy_images">
<span class="sig-prename descclassname"><span class="pre">sparcstools.image_processing.</span></span><span class="sig-name descname"><span class="pre">downsample_folder_copy_images</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">folder_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outdir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_threads</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_ending</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">('.tif',</span> <span class="pre">'.tiff')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sparcstools.image_processing.downsample_folder_copy_images" title="Link to this definition"></a></dt>
<dd><p>Multi-Threaded Function to downsample image equivalent to 2x2 binning. Duplicates images before downsampling! Do not run multiple times.
Output is saved as uint16.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>folder_path</strong> (<em>str</em>) – string indicating the folder containing all the image files that should be downsampled</p></li>
<li><p><strong>outdir</strong> (<em>str</em>) – string indicating the folder where the downsampled images should be generated</p></li>
<li><p><strong>num_threads</strong> (<em>int</em>) – number of threads for multithreading</p></li>
<li><p><strong>file_ending</strong> (<em>str</em><em> | </em><em>(</em><em>str</em><em>, </em><em>str</em><em>)</em>) – string or tuple of strings indicating which file ending the script should filter for in the indicated folder</p></li>
<li><p><strong>N</strong> (<em>int</em>) – number of pixels that should be binned together</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sparcstools.image_processing.downsample_img">
<span class="sig-prename descclassname"><span class="pre">sparcstools.image_processing.</span></span><span class="sig-name descname"><span class="pre">downsample_img</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sparcstools.image_processing.downsample_img" title="Link to this definition"></a></dt>
<dd><p>Function to downsample a single image equivalent to NxN binning using the mean between pixels.
Overwrites the original image(!), do not run multiple times on the same image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img_path</strong> (<em>str</em>) – string indicating the file path to the .tif file which should be downsampled.</p></li>
<li><p><strong>N</strong> (<em>int</em><em>, </em><em>default = 2</em>) – number of pixels that should be binned together using mean between pixels</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="Welcome to SPARCStools documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorials.html" class="btn btn-neutral float-right" title="1. Tutorials" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Sophia Maedler.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>